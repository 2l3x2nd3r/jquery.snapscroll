// Generated by CoffeeScript 1.4.0
(function() {

  (function($, window, document, undefined_) {
    var Plugin, defaults, pluginName;
    pluginName = "snapscroll";
    defaults = {
      scrollSpeed: 300,
      scrollOffset: 50
    };
    Plugin = function(element, options) {
      this.container = $(element);
      this.options = $.extend({}, defaults, options);
      return this.init();
    };
    Plugin.prototype = {
      init: function() {
        return this.scrollInit();
      },
      scrollInit: function() {
        var $children, end_scroll, prev_position, sa, scroll_offset, scroll_speed, timer;
        sa = this;
        scroll_speed = this.options.scrollSpeed;
        scroll_offset = this.options.scrollOffset;
        $children = this.container.children();
        prev_position = $(document).scrollTop();
        end_scroll = false;
        timer = null;
        return $(window).on("scroll.snapscroll", function() {
          var $child, cur_position, direction;
          cur_position = $(document).scrollTop();
          clearTimeout(timer);
          if (!end_scroll) {
            direction = sa.getDirection(prev_position, cur_position);
            $child = sa.getTargetChild($children, direction, cur_position);
            timer = setTimeout(function() {
              $(window).scrollTo($child, scroll_speed);
              return setTimeout(function() {
                return end_scroll = true;
              }, scroll_speed);
            }, scroll_offset);
          } else {
            end_scroll = false;
          }
          return prev_position = cur_position;
        });
      },
      getDirection: function(a, b) {
        if (a > b) {
          return "up";
        } else {
          return "down";
        }
      },
      getTargetChild: function($children, direction, position) {
        var $target, window_half, window_height;
        window_height = $children.first().height();
        window_half = window_height / 2;
        $target = null;
        $children.each(function() {
          var offsetY;
          offsetY = $(this).offset().top;
          if (direction === "up") {
            if (offsetY < position && position < offsetY + window_height) {
              return $target = $(this);
            }
          } else {
            if (offsetY < position + window_height && position < offsetY) {
              return $target = $(this);
            }
          }
        });
        return $target;
      }
    };
    return $.fn[pluginName] = function(options) {
      return this.each(function() {
        if (!$.data(this, "plugin_" + pluginName)) {
          return $.data(this, "plugin_" + pluginName, new Plugin(this, options));
        }
      });
    };
  })(jQuery, window, document);

}).call(this);
